/*! picadiff - v0.7.1 - 2014-03-06
* https://github.com/picapica-net/jQuery.picadiff
* Copyright (c) 2014 Jan Gra√üegger; Licensed MIT */
function DiffHandler(){diff_match_patch.call(this)}var Alignment=function(){this.linecount=0,this.wordcount=0,this.charcount=0,this.maxchars=10,this.line=""};Alignment.prototype.append=function(a,b){var c=a.split(" ");b&&(this.line+='<span class="'+b+'">');for(var d in c)this.charcount+=c[d].length+1,this.wordcount+=1,this.charcount>this.maxchars&&(this.line+="<br>",this.linecount+=1,this.charcount=c[d].length,this.wordcount=1),this.line+=c[d]+" ";this.line=this.line.trim(),b&&(this.line+="</span> ")},Alignment.prototype.appendStrict=function(a,b){var c=a.split("");b&&(this.line+='<span class="'+b+'">');for(var d in c)this.charcount>0&&this.charcount%this.maxchars===0&&(this.line+="<br>",this.linecount+=1,this.charcount=0),/^\s/g.test(c[d])&&0===this.charcount||(this.charcount+=1),this.line+=c[d];b&&(this.line+="</span>")},Alignment.prototype.setLineCountTo=function(a){if(0!==a)for(;this.linecount<=a;)this.line+="<br>",this.wordcount=0,this.charcount=0,this.linecount+=1},Alignment.prototype.setCharCountTo=function(a){for(;this.charcount<=a;)this.line+="&nbsp;",this.charcount+=1},DiffHandler.prototype=Object.create(diff_match_patch.prototype),DiffHandler.prototype.constructor=DiffHandler,DiffHandler.prototype.diff_html=function(a){for(var b=[],c=/&/g,d=/</g,e=/>/g,f=/\n/g,g=!1,h=0;h<a.length;h++){var i=a[h][0],j=a[h][1],k=j.replace(c,"&amp;").replace(d,"&lt;").replace(e,"&gt;").replace(f,"&para;<br>"),l="";switch(i){case DIFF_INSERT:g||(l+='<span class="edit">'),l+='<span class="insertion">'+k+"</span>",g&&(l+="</span>"),g=!g;break;case DIFF_DELETE:g||(l+='<span class="edit">'),l+='<span class="deletion">'+k+"</span>",g&&(l+="</span>"),g=!g;break;case DIFF_EQUAL:g&&(l+="</span>",g=!1),l+='<span class="equal">'+k.trim()+"</span> "}b[h]=l}return b.join("")},DiffHandler.prototype.equal_line=function(a,b){for(var c=[],d=0,e=0,f=0;f<a.length;f++)for(var g=a[f][0],h=a[f][1],i=0;i<h.length;i++)d++,"DIFF_EQUAL"===g&&e++,d%b===0&&(c[d/b-1]=0===e?0:e,e=0);return c};var dataArraytoString=function(a){var b="";for(var c in a)b+=a[c]+" ";return b},dataArraytoString2D=function(a,b){var c="";for(var d in a)c+=a[d][b]+" ";return c};DiffHandler.prototype.alligned_texts=function(a,b){var c=new Alignment,d=new Alignment;c.maxchars=b,d.maxchars=b;for(var e=0;e<a.length;e++){var f=a[e][0],g=a[e][1];switch(f){case DIFF_INSERT:d.append(dataArraytoString(g),"insertion");break;case DIFF_DELETE:c.append(dataArraytoString(g),"deletion");break;case DIFF_EQUAL:var h=dataArraytoString2D(g,1),i=dataArraytoString2D(g,0);if(h.length>10){var j=Math.max(c.linecount,d.linecount);c.setLineCountTo(j),d.setLineCountTo(j),c.append(i,"equal"),d.append(h,"equal")}else d.append(h,"insertion"),c.append(i,"deletion")}}return{diss_html:d.line,source_html:c.line}},DiffHandler.prototype.alligned_texts_strict=function(a,b){var c=new Alignment,d=new Alignment;c.maxchars=b,d.maxchars=b;for(var e=0;e<a.length;e++){var f=a[e][0],g=a[e][1];switch(f){case DIFF_INSERT:d.appendStrict(g,"insertion");break;case DIFF_DELETE:c.appendStrict(g,"deletion");break;case DIFF_EQUAL:if(g.length>10){var h=Math.max(c.linecount,d.linecount);c.setLineCountTo(h),d.setLineCountTo(h),c.appendStrict(g,"equal"),d.appendStrict(g,"equal")}else c.appendStrict(g,"deletion"),d.appendStrict(g,"insertion")}}return{diss_html:d.line,source_html:c.line}},jQuery.extend(diff_match_patch.prototype,{normalize_word:function(a){var b=/\[(\w+|[a-z]+)\]$/gi,c=/\W/gi,d=a.toLowerCase();return d=d.replace(b,"").replace(c,"")},words_to_characters:function(a){var b="";for(var c in a){var d,e=a[c],f=this.normalize_word(e);if(this.word_dict.hasOwnProperty(f)){d=this.word_dict[f],b+=d,this.char_dict[d].length!==this.textnumber+1&&this.char_dict[d].push([]);var g=this.char_dict[d][this.textnumber];g.push(e)}else d=String.fromCharCode(this.charcode),this.word_dict[f]=d,this.char_dict[d]=[],this.char_dict[d].push([]),this.char_dict[d][this.textnumber]=[e],this.charcode+=1,b+=d}return this.textnumber+=1,b},split_text:function(a){return a=a.replace(/\r|\n/g," ").replace(/\s+/g," ").trim(),0===a.length?[]:a.split(/\s/g)},diff_wordbased:function(a,b,c){var d=this.split_text(a),e=this.split_text(b);this.word_dict={},this.charcode=21,this.textnumber=0,this.char_dict={};for(var f=this.words_to_characters(d),g=this.words_to_characters(e),h=this.diff_main(f,g,c),i=[],j=0;j<h.length;j++){var k=h[j][0],l=h[j][1],m=[],n=l.split("");for(var o in n){var p=n[o],q=this.char_dict[p],r=[];switch(k){case DIFF_DELETE:r=q[0][0],q[0].splice(0,1);break;case DIFF_INSERT:r=q[1][0],q[1].splice(0,1);break;case DIFF_EQUAL:r.push(q[0][0]),r.push(q[1][0]),q[0].splice(0,1),q[1].splice(0,1)}m.push(r),o+=1}i.push([k,m])}return i}}),function(a){var b=function(a,b){this.dmp=new DiffHandler,this.dmp.Diff_Timeout=b?b.timeout||0:0;for(var c in a)this[c]=a[c]};b.prototype={getDiff:function(){if(!this.diff){var a=this.left,b=this.right;this.diff=this.dmp.diff_wordbased(a,b,!1)}return this.diff},getHtmlTexts:function(a){var b=this.getDiff();return this.dmp.alligned_texts(b,a)},getHtmlTextStrict:function(a){var b=this.getDiff();return this.dmp.alligned_texts_strict(b,a)}},a.fn.picadiff=function(c){return void 0!==window.WebFont&&WebFont.load({google:{families:["Source Code Pro"]}}),this.each(function(){var d=a(this).addClass("picadiff"),e={leftContainer:".left",rightContainer:".right",titleContainer:".picadiff-title",contentContainer:".picadiff-content",lineLength:40,wrap:!1};c&&a.extend(e,c);var f={leftTitle:e.leftTitle||d.find(e.titleContainer+" "+e.leftContainer).text(),left:e.leftContent||d.find(e.contentContainer+" "+e.leftContainer).text(),rightTitle:e.rightTitle||d.find(e.titleContainer+" "+e.rightContainer).text(),right:e.rightContent||d.find(e.contentContainer+" "+e.rightContainer).text()},g=new b(f,e),h=e.lineLength,i=e.wrap?g.getHtmlTextStrict(h):g.getHtmlTexts(h),j=i.source_html,k=i.diss_html;a(e.contentContainer+" "+e.leftContainer).html(j),a(e.contentContainer+" "+e.rightContainer).html(k),a(e.titleContainer+" "+e.leftContainer).html(g.leftTitle),a(e.titleContainer+" "+e.rightContainer).html(g.rightTitle)})}}(jQuery);